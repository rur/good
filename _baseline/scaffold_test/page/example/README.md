# Page `example`

This is a page within the `github.com/rur/good/baseline/scaffold_test` HTML web app.

## Page Scaffold Reference

The code was originally generated by the [good scaffold](https://www.github.com/rur/good), using sometime like

```
good page ./baseline/scaffold_test example
```

This reference guide is intended to help you to work with the scaffold code.

### Routemap Overview

The `routemap.toml` file is the configuration for template composition and
mappings to HTTP routes and handlers in this page.

- It is the _source of truth_ for how templates, handlers and paths are mapped within the page.
- It is used to generate the _routes.go_ code with the `good routes ./baseline/scaffold_test example` command
- It is capable of describing many variations of the page layout
- HTTP endpoints can be bound to a specific layouts

#### Modifying the Routemap

Add or change endpoints by editing the TOML file and running the go generate command
to update the page routes code.

```
go generate github.com/rur/good/baseline/scaffold_test
```

##### Auto-gen handlers and template files

It can be tedious to create and configure template files and handlers when adding new views
so, as a convenience, if the `_template` or `_handler` fields are missing from the routemap when the
_routes.go_ file is generated, the missing items will be generated for you.

#### Example of basic composition

The sample below specifies two endpoints: `/mypage` and `/mypage/details`, each with a different
template for the _my-content_ section. In this example, the _base.html.tmpl_ file
will contain a `"my-content"` template block.

###### Example of a routemap file located at `[site]/page/mypage/routemap.toml`

```TOML
_ref = "mypage"
_template = "page/templates/base.html.tmpl"
_handler = "hlp.BindEnv(myPageBaseHandler)"

    [my-content]
    _ref = "welcome"
    _path = "/mypage"
    _handler = "hlp.BindEnv(bindResources(welcomeHandler))"
    _template = "page/mypage/templates/content/welcome.html.tmpl"

    [my-content]
    _ref = "details"
    _path = "/mypage/details"
    _handler = "hlp.BindEnv(bindResources(detailsHandler))"
    _template = "page/mypage/templates/content/details.html.tmpl"

```

Preview of the `base.html.tmpl` template with a _my-content_ block positioned in the layout.

```html
<!DOCTYPE html>
<html>
  ... {{ template "my-content" .MyContent }} ...
</html>
```

#### Example of advanced composition

The next sample shows more advanced layout features suitable for modern web apps.
The example is a settings page with sections for basic and advanced controls.
The _advanced_ section includes nested sidebar navigation.

In this sample you will find the following paths: `/settings`, `/advanced-settings/user`
and `/advanced-settings/organization`.

Note that the `_default` flag is used to include a given template in the parent
template layout by default.

###### Example of a routemap located at `[site]/page/settings/routemap.toml`

```TOML
_ref = "settings"
_template = "page/templates/base.html.tmpl"
_handler = "hlp.BindEnv(settingsBaseHandler)"

    [sitenav]
    _ref = "pagenav"
    _default = true
    _handler = "treetop.Noop"
    _template = "page/settings/templates/sitenav/pagenav.html.tmpl"

    [content]
    _ref = "basic-settings"
    _path = "/settings"
    _handler = "hlp.BindEnv(bindResources(basicSettingsHandler))"
    _template = "page/settings/templates/content/basic-settings.html.tmpl"

    [content]
    _ref = "advanced-section"
    _handler = "hlp.BindEnv(bindResources(advancedSectionHandler))"
    _template = "page/settings/templates/content/advanced-section.html.tmpl"

        [content.sidebar]
        _ref = "adv-tabs"
        _default = true
        _handler = "hlp.BindEnv(advancedTabsHandler)"
        _template = "page/settings/templates/content/sidebar/adv-tabs.html.tmpl"

        [content.tabcontent]
        _ref = "advanced-user"
        _path = "/advanced-settings/user"
        _template = "page/settings/templates/content/tabcontent/advanced-user.html.tmpl"
        _handler = "hlp.BindEnv(bindResources(advancedUserHandler))"

        [content.tabcontent]
        _ref = "advanced-org"
        _path = "/advanced-settings/organization"
        _template = "page/settings/templates/content/tabcontent/advanced-org.html.tmpl"
        _handler = "hlp.BindEnv(bindResources(advancedOrgHandler))"

```

If you wish to understand the plumbing, try scanning the generated routes.go file.
It might be helpful to use the [Treetop Library docs](https://pkg.go.dev/github.com/rur/treetop) as a reference.

### Template Handlers Overview

Each template in a composition is matched with a handler function via the routemap. There are some predefined handlers
for trivial tasks like constants `treetop.Constant(123)` or no-op `treetop.Noop`, but typically you will pass a custom
function that loads template data for the layout.

The minimal, top level signature that is required is this

```
func myHandler(resp treetop.Response, req *http.Request) interface{} {
  return "data for the template"
}
```

#### Site Env

If your handler needs to access site-wite services or configuration, you can bind an extra parameter
in the routemap like so `_handler = "hlp.BindEnv(myHandlerWithEnv)"`

```
func myHandlerWithEnv(env service.Env, resp treetop.Response, req *http.Request) interface{} {
  return "data for the template"
}
```

#### Request Resources

Within the example page package the `resources.go` file load a set of per-request resources, like user details
or DB data based on the request. You can bind an additional resources parameter to you handlers in the routemap
like so `_handler = "hlp.BindEnv(bindResources(myHandlerWithResources))"`

```
func myHandlerWithResources(rsc resources, env service.Env, resp treetop.Response, req *http.Request) interface{} {
  return "data for the template"
}
```

### Templates Overview

The set up uses standard HTML Golang template files. The template files themselves are organized within the page _templates_
directory with a `.html.tmpl` extension and nested in sub directories based on nested template blocks. These rules are
purely by convention, feel free to disregard. The routemap can refer to any file in one of the embedded template directories.

#### Template Embedding

The file byte embedding features of the Go compiler are used to include assets in you binary at compile time.
The scaffold site is configured to embed the following template directories:

- shared page templates `[site]/page/templates` and
- template files for each named page `[site]/page/{name}/templates`

Note templates are read from disk in development mode, see the `--dev` flag.
